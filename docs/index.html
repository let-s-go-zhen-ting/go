<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Let's Goï¼ï¼ï¼ï½œé¦–é </title>
  <link rel="stylesheet" href="assets/ui.css?v=4">
</head>
<body>
  <!-- é ‚éƒ¨ï¼šå·¦ä¸Šé ­è²¼ â†’ é–‹å•Ÿå´æ‹‰ï¼›å³å´æ˜¯è³¼ç‰©è»Š -->
  <header class="header-bar">
  <button id="avatarBtn" class="avatar" aria-label="é–‹å•Ÿå€‹äººé¸å–®">æˆ‘</button>

  <input id="search" class="search flex1" placeholder="æœå°‹å•†å“åç¨±â€¦ï¼ˆä¾‹å¦‚ æ‰‹å¹…ï¼‰">

  <!-- ä¸‹æ‹‰ 1ï¼šåˆ†é¡ -->
  <select id="category" class="select">
    <option value="ALL">å…¨éƒ¨åˆ†é¡</option>
    <option value="å‘¨é‚Š">å‘¨é‚Š</option>
    <option value="æ¼”å‡º">æ¼”å‡º</option>
  </select>

  <!-- ä¸‹æ‹‰ 2ï¼šæ’åº -->
  <select id="sort" class="select">
    <option value="default">é è¨­æ’åº</option>
    <option value="price_asc">åƒ¹æ ¼ä½â†’é«˜</option>
    <option value="price_desc">åƒ¹æ ¼é«˜â†’ä½</option>
  </select>

  <!-- ä¸‹æ‹‰ 3ï¼šç¯©é¸ -->
  <select id="filter" class="select">
    <option value="all">å…¨éƒ¨å•†å“</option>
    <option value="new">åªçœ‹æ–°ä¸Š</option>
    <option value="instock">åªçœ‹æœ‰åº«å­˜</option>
  </select>

  <div class="cart-group">
    <a href="checkout.html" class="btn secondary">è³¼ç‰©è»Š/çµå¸³</a>
    <span class="badge" id="cartCount">0</span>
  </div>
</header>


  <!-- æœ€è¿‘ç€è¦½ -->
  <section class="card">
    <h2>ä½ æœ€è¿‘çœ‹é</h2>
    <div id="recentGrid" class="grid"></div>
    <div class="small">ï¼ˆé»ã€Œçœ‹ä¸€ä¸‹ã€æœƒè¨˜éŒ„åˆ°é€™è£¡ï¼‰</div>
  </section>

  <!-- æ–°ä¸Š -->
  <section class="card">
    <h2>æ–°ä¸Š</h2>
    <div id="newGrid" class="grid"></div>
  </section>

  <!-- å…¨éƒ¨å•†å“ï¼ˆæ”¯æ´æœå°‹èˆ‡åˆ†é¡ï¼‰ -->
  <section class="card">
    <h2>å…¨éƒ¨å•†å“</h2>
    <div id="allGrid" class="grid"></div>
  </section>

  <!-- å´æ‹‰æŠ½å±œ -->
  <div id="drawerMask"></div>
<aside id="drawer" aria-label="å€‹äººå´æ‹‰é¢æ¿">
  <div id="drawerProfile"><!-- JS æœƒæŠŠå…§å®¹å¡é€²ä¾† --></div>
</aside>


  <script type="module">
  import { setCart, getCart, renderCards, getRecent, filterProducts, setupDrawer, initProducts, PRODUCTS } from './assets/app.js?v=3';

  // å…ˆæŠ“è©¦ç®—è¡¨ï¼Œå†æ¸²æŸ“
  await initProducts('1BDw71gFOYp0e2kqOZFkfbV5v1dgC99kgwUEaHwjvxTk','å•†å“');

    // åˆå§‹åŒ–è³¼ç‰©è»Šå¾½ç« 
    setCart(getCart());

    // æ–°ä¸Š
    const newGrid = document.getElementById('newGrid');
    const newList = PRODUCTS.filter(p=>p.isNew);
    renderCards(newGrid, newList);

    // æœ€è¿‘ç€è¦½
    const recentGrid = document.getElementById('recentGrid');
    const recentList = getRecent();
    if(recentList.length){
      renderCards(recentGrid, recentList);
    }else{
      recentGrid.innerHTML = '<div class="small">é‚„æ²’æœ‰è¶³è·¡å–”ï½</div>';
    }

    // å…¨éƒ¨å•†å“ + æœå°‹/åˆ†é¡
    const allGrid = document.getElementById('allGrid');
  const search  = document.getElementById('search');
  const category= document.getElementById('category');

  function rerender(){
    let list = filterProducts({ q: search.value, cat: category.value });

    const f = document.getElementById('filter').value;
    if (f === 'new')     list = list.filter(p => p.isNew);
    if (f === 'instock') list = list.filter(p => (p.stock ?? 0) > 0);

    const s = document.getElementById('sort').value;
    if (s === 'price_asc')  list = list.slice().sort((a,b)=> a.price - b.price);
    if (s === 'price_desc') list = list.slice().sort((a,b)=> b.price - a.price);

    renderCards(allGrid, list);
  }

  search.addEventListener('input', rerender);
  category.addEventListener('change', rerender);
  document.getElementById('sort').addEventListener('change', rerender);
  document.getElementById('filter').addEventListener('change', rerender);

  rerender();  // ğŸ‘ˆ é€™è¡Œä¸€å®šè¦æœ‰ï¼Œé¦–æ¬¡æ¸²æŸ“
  setupDrawer();


    // å•Ÿå‹•å´æ‹‰é¢æ¿
    setupDrawer();
  </script>
</body>
</html>
