<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>商品詳情</title>
  <link rel="stylesheet" href="assets/ui.css">
  <!-- Favicon / PWA icons -->
<link rel="icon" type="image/png" href="favicon.png?v=2">
<link rel="apple-touch-icon" href="apple-touch-icon.png?v=2">

</head>
<body>
  <div class="corner-brand">
    <img src="favicon.png" alt="logo">
    <div>
    <div class="brand-zh">啦此購</div>
    <div class="brand-en">Let's Go！！！</div>
    </div>
  </div>
  
  <header>
    <div><a class="btn secondary" href="index.html">← 回商店</a></div>
    <h1 id="title" style="margin-left:12px">商品</h1>
    <div style="margin-left:auto">
      <a href="checkout.html" class="btn secondary">購物車/結帳</a>
      <span class="badge" id="cartCount">0</span>
    </div>
  </header>

  <section class="card" id="box">載入中…</section>

<script type="module">
  import {
    initProducts, PRODUCTS, setCart, getCart, addToCartById, pushRecent
  } from './assets/app.js';

  // 你的表ID＋分頁名
  await initProducts('1BDw71gFOYp0e2kqOZFkfbV5v1dgC99kgwUEaHwjvxTk','商品');
  setCart(getCart());

  const fmt = n => n.toLocaleString('zh-Hant-TW');
  const id = new URLSearchParams(location.search).get('id') || '';
  const p = PRODUCTS.find(x=>x.id===id);

  const box = document.getElementById('box');
  if(!p){
    box.innerHTML = `<div class="small">找不到此商品（ID: ${id}）。</div>`;
  }else{
    // 記錄最近瀏覽
    pushRecent(p.id);

    document.getElementById('title').textContent = p.title;
    box.innerHTML = `
      <div class="row" style="gap:16px; align-items:flex-start; flex-wrap:wrap">
        <div style="flex:1; min-width:280px">
          ${p.image ? `<img src="${p.image}" alt="${p.title}" style="width:100%;border-radius:12px;object-fit:cover;aspect-ratio:1/1;">` : ''}
        </div>
        <div style="flex:1; min-width:260px">
          <h2 style="margin:0 0 8px 0">${p.title} ${p.isNew ? '<span class="badge new">NEW</span>' : ''}</h2>
          <div class="small" style="margin-bottom:6px">分類：${p.category || '其他'}</div>
          <div style="font-size:20px; font-weight:700; margin:8px 0">NT$ ${fmt(p.price)}</div>
          <div style="margin:6px 0">
            ${(p.stock ?? 0) > 0
              ? `<span class="badge">庫存 ${p.stock}</span>`
              : `<span class="badge" style="border-color:#b91c1c;color:#b91c1c">缺貨</span>`
            }
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="addBtn" ${(p.stock ?? 0) <= 0 ? 'disabled' : ''}>加入購物車</button>
            <a class="btn secondary" href="checkout.html">前往結帳</a>
          </div>
        </div>
      </div>
    `;
    document.getElementById('addBtn')?.addEventListener('click', ()=>{
      addToCartById(p.id);
      setCart(getCart()); // 更新徽章
    });
  }
</script>
</body>
</html>
