<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>商品詳情</title>
  <link rel="stylesheet" href="assets/ui.css">
  <!-- Favicon / PWA icons -->
<link rel="icon" type="image/png" href="favicon.png?v=2">
<link rel="apple-touch-icon" href="apple-touch-icon.png?v=2">

</head>
<body>
  <div class="corner-brand">
    <img src="favicon.png" alt="logo">
    <div>
    <div class="brand-zh">啦此購</div>
    <div class="brand-en">Let's Go！！！</div>
    </div>
  </div>
  
  <header>
    <div><a class="btn secondary" href="index.html">← 回商店</a></div>
    <h1 id="title" style="margin-left:12px">商品</h1>
    <div style="margin-left:auto">
      <a href="checkout.html" class="btn secondary">購物車/結帳</a>
      <span class="badge" id="cartCount">0</span>
    </div>
  </header>

  <main>
  <section class="card" id="box">載入中…</section>

  <script type="module">
  import {
    initProducts, PRODUCTS, setCart, getCart, addToCartById, pushRecent
  } from './assets/app.js?v=8';

  // 請換成你的試算表 ID & 分頁名
  await initProducts('1BDw71gFOYp0e2kqOZFkfbV5v1dgC99kgwUEaHwjvxTk','商品');
  setCart(getCart());

  const fmt = n => Number(n||0).toLocaleString('zh-Hant-TW');
  const id  = new URLSearchParams(location.search).get('id') || '';
  const p   = PRODUCTS.find(x=>x.id===id);
  const box = document.getElementById('box');

  if(!p){
    box.innerHTML = `<div class="small">找不到此商品（ID: ${id}）。</div>`;
  } else {
    pushRecent(p.id);

    document.getElementById('title').textContent = p.title;

    const badges = `
      ${p.isNew ? '<span class="badge new">NEW</span>' : ''}
      ${p.isPreorder ? '<span class="badge preorder">預購</span>' : ''}
    `;
    const eta  = (p.isPreorder && p.eta) ? `<div class="small" style="margin-top:4px">預計出貨：${p.eta}</div>` : '';
    const desc = p.desc ? `<div style="white-space:pre-wrap;margin-top:8px">${p.desc}</div>` : '';

    box.innerHTML = `
      <div class="row" style="gap:16px; align-items:flex-start; flex-wrap:wrap">
        <div style="flex:1; min-width:280px">
          ${p.image ? `<img src="${p.image}" alt="${p.title}" style="width:100%;border-radius:12px;object-fit:cover;aspect-ratio:1/1;">` : ''}
        </div>
        <div style="flex:1; min-width:260px">
          <h2 style="margin:0 0 8px 0">${p.title} ${badges}</h2>
          ${eta}
          <div class="small" style="margin-bottom:6px">分類：${p.category || '其他'}</div>
          <div style="font-size:20px; font-weight:700; margin:8px 0">NT$ ${fmt(p.price)}</div>
          <div style="margin:6px 0">
            ${(p.stock ?? 0) > 0
              ? `<span class="badge">庫存 ${p.stock}</span>`
              : `<span class="badge" style="border-color:#b91c1c;color:#b91c1c">缺貨</span>`
            }
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn" id="addBtn" ${(p.stock ?? 0) <= 0 ? 'disabled' : ''}>加入購物車</button>
            <a class="btn secondary" href="checkout.html">前往結帳</a>
          </div>
          ${desc}
        </div>
      </div>
    `;

    document.getElementById('addBtn')?.addEventListener('click', ()=>{
      addToCartById(p.id);
      setCart(getCart());
    });
  }
</script>

</main>

  <footer class="site-footer">
  <div class="row" style="justify-content:space-between">
    <div>
      <strong>客服資訊</strong><br>
      Email：<a href="mailto:letsgozhenting@gmail.com">letsgozhenting@gmail.com</a><br>
      LINE：<a href="https://lin.ee/305cGr5" target="_blank" rel="noopener">https://lin.ee/305cGr5</a><br>
      FB：<a href="https://www.facebook.com/share/17UF5BshaN/" target="_blank" rel="noopener">Facebook</a><br>
      IG：<a href="https://www.instagram.com/letsgo.zhen.ting?igsh=YmM3NTU2aHllMWl2" target="_blank" rel="noopener">@letsgo.zhen.ting</a>
    </div>
    <nav>
      <a href="privacy.html">隱私權條款</a> <span class="sep">｜</span>
      <a href="consumer-rights.html">消費者權益</a> <span class="sep">｜</span>
      <a href="tos.html">會員服務條款</a> <span class="sep">｜</span>
      <a href="returns.html">退換貨方式</a>
    </nav>
  </div>
  <div style="margin-top:8px;color:#9ca3af">© 2025 啦此購</div>
</footer>

</body>
</html>
